name: Coverity Scan

# We only want to test official release code, not every pull request.
on:
# Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  coverity:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        depth: 0
    - name: dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y cmake git build-essential pkg-config gettext libavahi-client-dev libssl-dev zlib1g-dev wget bzip2 git-core liburiparser-dev libpcre2-dev libdvbcsa-dev python3 python3-requests debhelper ccache
    - name: Configure
      run: ./configure --disable-dvbcscan --disable-tvhcsa
    - uses: vapier/coverity-scan-action@v1
      with:
        email: ${{ secrets.COVERITY_SCAN_EMAIL }}
        token: ${{ secrets.COVERITY_SCAN_TOKEN }}
